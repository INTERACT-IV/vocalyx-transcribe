# =====================================================================
# Vocalyx Transcribe - Configuration File
# =====================================================================

[CORE]
# Nom unique de cette instance de worker
instance_name = worker-01

[API]
# URL de vocalyx-api pour communiquer
# En local: http://localhost:8000
# En Docker: http://vocalyx-api:8000
url = http://localhost:8000

# Timeout des requêtes HTTP (en secondes)
timeout = 60

[CELERY]
# Configuration Celery (DOIT correspondre à vocalyx-api)
broker_url = redis://192.168.1.235:6379/0
result_backend = redis://192.168.1.235:6379/0

[WHISPER]
# Modèle Whisper à utiliser
# Options: tiny, base, small, medium, large-v2, large-v3
# Recommandé: small (bon équilibre vitesse/qualité)
model = /home/shinohk/code/vocalyx-all/shared/models/openai-whisper-small

# Device de calcul
# Options: cpu, cuda (GPU NVIDIA), auto
device = cpu

# Type de calcul
# Options: int8, int8_float16, float16, float32
# int8: Le plus rapide (CPU uniquement)
# float16: Bon équilibre (GPU)
compute_type = int8

# Nombre de threads CPU pour l'inférence
# Recommandé: nombre de cœurs CPU - 2
cpu_threads = 8

# Langue par défaut (forcer la langue accélère la transcription)
# Options: fr, en, es, de, it, pt, nl, etc.
# Laisser vide pour détection automatique
language = fr

[PERFORMANCE]
# Nombre de workers Celery (concurrence)
# Celery gère la concurrence, ne pas confondre avec l'ancien max_workers
# Recommandé: entre 1 et 4 selon votre CPU/GPU
max_workers = 2

# Longueur des segments audio en millisecondes
# Pour audios longs, ils seront découpés en segments de cette taille
segment_length_ms = 45000

# Activer VAD (Voice Activity Detection)
# true: Ignore les silences = plus rapide
vad_enabled = true

# Beam size pour le décodage (qualité vs vitesse)
# 1 = greedy search (plus rapide, recommandé pour CPU)
# 5 = meilleure qualité mais plus lent (recommandé pour GPU)
# Optimisé pour CPU: 1
beam_size = 1

# Best of pour le décodage (nombre de recherches parallèles)
# 1 = une seule recherche (plus rapide, recommandé pour CPU)
# 5 = meilleure qualité mais plus lent
# Optimisé pour CPU: 1
best_of = 1

# Temperature pour le sampling
# 0.0 = déterministe (recommandé)
temperature = 0.0

[PATHS]
# Répertoire partagé pour les uploads (DOIT être identique à vocalyx-api)
upload_dir = /home/shinohk/code/vocalyx-all/shared/uploads

[VAD]
# VAD (Voice Activity Detection) - Paramètres pour faster-whisper 1.1.0+
# Optimisé pour CPU avec VAD intégré de faster-whisper (plus rapide que pydub)

# Seuil de probabilité de parole (0.0-1.0)
# Plus élevé = plus strict (moins de faux positifs)
# Optimisé CPU: 0.5 (équilibre vitesse/qualité)
threshold = 0.5

# Durée minimum de parole pour être considérée (en ms)
# Optimisé CPU: 250ms (balance vitesse/détection)
min_speech_duration_ms = 250

# Durée minimum de silence entre segments (en ms)
# Optimisé CPU: 500ms (plus court = plus de segments mais plus rapide)
min_silence_duration_ms = 500

# Padding ajouté autour des segments de parole (en ms)
# Optimisé CPU: 400ms (bon compromis)
speech_pad_ms = 400

[LOGGING]
# Niveau de log: DEBUG, INFO, WARNING, ERROR, CRITICAL
level = INFO

# Activer les logs dans un fichier
file_enabled = true

# Chemin du fichier de log
file_path = /home/shinohk/code/vocalyx-all/shared/logs/vocalyx-transcribe.log

# Activer les couleurs dans la console
colored = true

[SECURITY]
# Clé secrète pour la communication avec l'API (DOIT être identique à vocalyx-api)
# ⚠️ CHANGER CETTE VALEUR EN PRODUCTION
internal_api_key = SuperSecretCode123